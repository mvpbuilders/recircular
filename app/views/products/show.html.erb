<div class="container-fluid mt-5">
  <div class="row">
    <!-- Imagen -->
    <div class="col-12 col-lg-6 text-center">
      <% if @product.images.attached? %>
        <div class="mb-3">
          <%= image_tag @product.images.first.variant(resize_to_limit: [500, 500]),
              class: "img-fluid rounded main-image",
              id: "mainProductImage" %>
        </div>

        <div class="d-flex gap-2 justify-content-center flex-wrap">
          <% @product.images.each_with_index do |image, index| %>
            <%= image_tag image.variant(resize_to_limit: [80, 80]),
                class: "img-thumbnail thumb-image #{'border border-primary' if index == 0}",
                data: { large: url_for(image.variant(resize_to_limit: [500, 500])) },
                onclick: "updateMainImage(this)",
                style: "object-fit: cover; cursor: pointer;" %>
          <% end %>
        </div>
      <% else %>
        <%= image_tag "ropa.png", class: "img-fluid rounded shadow", alt: "Imagen no disponible" %>
      <% end %>
    </div>

    <!-- Info -->
    <div class="col-12 col-lg-6 mt-4 mt-lg-0">

      <h4 class="fw-semibold mb-2"><%= @product.title %></h4>

      <p class="fs-5 fw-bold mb-1">
        $<%= number_with_delimiter(@product.precio, delimiter: ".") %>
      </p>
      <p class="text-muted mb-2"><%= @product.description %></p>

      <% if @product.condition.present? %>
        <p class="mb-3"><strong>Condici√≥n:</strong> <%= @product.condition %></p>
      <% end %>

      <hr class="my-4">

      <!-- Formulario de compra -->
      <%= form_with model: @order, url: orders_path, method: :post, local: true, html: { data: { controller: "order-validation" } } do |f| %>
        <%= f.hidden_field :product_id, value: @product.id, name: "order[product_id]" %>

        <p class="fw-semibold">Tu informaci√≥n de contacto</p>
        <div class="mb-3">
          <label for="order_email" class="form-label">Correo electr√≥nico</label>
          <%= email_field_tag "order[email]", nil, class: "form-control w-100", placeholder: "Email", required: true,
                data: { order_validation_target: "email", action: "input->order-validation#validateEmail" } %>
          <div data-order-validation-target="errorEmail" class="text-danger small mt-1"></div>
        </div>

        <!-- Bot√≥n estilo Quiero Vender -->
        <div class="d-grid mt-4">
          <%= submit_tag "Iniciar compra", class: "btn btn-dark rounded-4 fw-semibold py-2 text-white" %>
        </div>
        <div class="d-grid mt-4">
          <%= submit_tag "Agregar al carrito", class: "btn btn-outline-dark rounded-4 fw-semibold py-2" %>
        </div>

        <div class="payment-box text-center mt-4">
          <p class="fw-semibold mb-3 text-secondary">
            <i class="bi bi-shield-lock-fill me-1"></i> Pago seguro garantizado
          </p>
          <div class="payment-logo-group">
            <%= image_tag "mercadopago1.svg", alt: "Mercado Pago", class: "payment-logo" %>
            <%= image_tag "visa1.svg", alt: "Visa", class: "payment-logo" %>
            <%= image_tag "mastercard1.svg", alt: "Mastercard", class: "payment-logo" %>
          </div>
        </div>

        <p class="text-muted small mt-3 text-center">
          Derecho de devoluci√≥n o reclamo hasta 30 d√≠as desde la entrega
        </p>
      <% end %>
    </div>
  </div>
</div>

  <!-- Separador -->
  <hr class="my-5">

  <!-- FAQs -->
  <div class="container py-5">
    <div class="row">
      <div class="col-12">
        <h2 class="section-title text-center mb-5">Preguntas frecuentes</h2>
        <div class="accordion" id="faqAccordion">
          <% [
            ["‚ùì ¬øQu√© es Recircular?", "Es una plataforma para comprar y vender cosas usadas de manera simple y confiable."],
            ["üì¶ ¬øCu√°les son los tiempos de entrega?", "Entre 3 y 7 d√≠as h√°biles seg√∫n tu localidad."],
            ["üí∏ ¬øCu√°nto cuesta el env√≠o?", "Estamos bonificando el env√≠o durante los primeros meses."],
            ["üßæ ¬øQu√© m√©todos de pago aceptan?", "Tarjetas, transferencias y Mercado Pago."],
            ["üîÑ ¬øC√≥mo devuelvo un producto?", "Ten√©s 10 d√≠as para iniciar devoluci√≥n sin costo."],
            ["‚úÖ ¬øC√≥mo s√© si mi pedido fue exitoso?", "Recib√≠s un email de confirmaci√≥n. Revis√° spam si no lo encontr√°s."]
          ].each_with_index do |(question, answer), i| %>
            <div class="accordion-item">
              <h2 class="accordion-header" id="faq<%= i %>">
                <button class="accordion-button <%= i > 0 ? 'collapsed' : '' %>" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= i %>">
                  <%= question %>
                </button>
              </h2>
              <div id="collapse<%= i %>" class="accordion-collapse collapse <%= i == 0 ? 'show' : '' %>">
                <div class="accordion-body">
                  <%= answer %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  function updateMainImage(thumbnail) {
    const newSrc = thumbnail.dataset.large;
    const mainImage = document.getElementById("mainProductImage");

    if (mainImage && newSrc) {
      mainImage.src = newSrc;

      document.querySelectorAll(".thumb-image").forEach(img => {
        img.classList.remove("border", "border-primary");
      });

      thumbnail.classList.add("border", "border-primary");
    }
  }
</script>
